version: "3.8"

services:
    web_search_agent:
        build:
            context: ../
            dockerfile: ./agents/web_search/Dockerfile
        container_name: web_search_agent
        ports:
            - "8010:8000"
        environment:
            - REGISTRY_URL=http://registry:8000
            - RABBITMQ_HOST=rabbitmq
            - RABBITMQ_PORT=5672
            - CONTAINER_NAME=web_search_agent
            - PORT=8000
            - OPENAI_API_KEY=${OPENAI_API_KEY:-***REMOVED***proj-Z9xpJQlE6j2LJqUNxWwFk1BrJwgaf6ai1Pase_qZdjBcNwUUqkW-z-iWlymnqON_WlLpXZL8J2T3BlbkFJFdDQE_PlQwnd9h8TQ7NpaZGBAB-ukoN88VWCh0aaS7KYdvKoRtXAJvviTF9inX_sEilr1c5rMA}
            - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY:-***REMOVED***ant-test-key}
            - LOG_LEVEL=DEBUG
            - PYTHONPATH=/app
        volumes:
            - ../common:/app/common
            - ./web_search:/app/agent
            - ./start_agents.sh:/app/agent/start.sh
        command:
            [
                "bash",
                "-c",
                "chmod +x /app/agent/start.sh && /app/agent/start.sh",
            ]
        restart: always
        networks:
            - agent-network
            - multiagent-network

    writer_agent:
        build:
            context: ../
            dockerfile: ./agents/writer/Dockerfile
        container_name: writer_agent
        ports:
            - "8011:8000"
        environment:
            - REGISTRY_URL=http://registry:8000
            - RABBITMQ_HOST=rabbitmq
            - RABBITMQ_PORT=5672
            - CONTAINER_NAME=writer_agent
            - PORT=8000
            - OPENAI_API_KEY=${OPENAI_API_KEY:-***REMOVED***proj-Z9xpJQlE6j2LJqUNxWwFk1BrJwgaf6ai1Pase_qZdjBcNwUUqkW-z-iWlymnqON_WlLpXZL8J2T3BlbkFJFdDQE_PlQwnd9h8TQ7NpaZGBAB-ukoN88VWCh0aaS7KYdvKoRtXAJvviTF9inX_sEilr1c5rMA}
            - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY:-***REMOVED***ant-test-key}
            - LOG_LEVEL=DEBUG
            - PYTHONPATH=/app
        volumes:
            - ../common:/app/common
            - ./writer:/app/agent
            - ./start_agents.sh:/app/agent/start.sh
        command:
            [
                "bash",
                "-c",
                "chmod +x /app/agent/start.sh && /app/agent/start.sh",
            ]
        restart: always
        networks:
            - agent-network
            - multiagent-network

    code_generator_agent:
        build:
            context: ../
            dockerfile: ./agents/code_generator/Dockerfile
        container_name: code_generator_agent
        ports:
            - "8012:8000"
        environment:
            - REGISTRY_URL=http://registry:8000
            - RABBITMQ_HOST=rabbitmq
            - RABBITMQ_PORT=5672
            - CONTAINER_NAME=code_generator_agent
            - PORT=8000
            - OPENAI_API_KEY=${OPENAI_API_KEY:-***REMOVED***proj-Z9xpJQlE6j2LJqUNxWwFk1BrJwgaf6ai1Pase_qZdjBcNwUUqkW-z-iWlymnqON_WlLpXZL8J2T3BlbkFJFdDQE_PlQwnd9h8TQ7NpaZGBAB-ukoN88VWCh0aaS7KYdvKoRtXAJvviTF9inX_sEilr1c5rMA}
            - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY:-***REMOVED***ant-test-key}
            - LOG_LEVEL=DEBUG
            - PYTHONPATH=/app
        volumes:
            - ../common:/app/common
            - ./code_generator:/app/agent
            - ./start_agents.sh:/app/agent/start.sh
        command:
            [
                "bash",
                "-c",
                "chmod +x /app/agent/start.sh && /app/agent/start.sh",
            ]
        restart: always
        networks:
            - agent-network
            - multiagent-network

networks:
    agent-network:
    multiagent-network:
        external: true
